<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="How to configure multifactor authentication with Microsoft Entra ID" name="description" />
<meta content="Azure, Entra ID, external authentication, multifactor authentication, mfa" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Integrating with Microsoft Entra ID &mdash; Micetro by Men&amp;Mice - 11.0  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Integrating with Okta" href="mfa_okta.html" />
    <link rel="prev" title="External Authentication" href="webapp_external_auth.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Micetro by Men&Mice - 11.0
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Micetro</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Contacting Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opensource.html">Open-Source Licenses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Micetro Installation Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="implementation.html">Implementation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="configuration.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="running_micetro.html">Running the Micetro Components (Central, Agents)</a></li>
<li class="toctree-l2"><a class="reference internal" href="controller_logging.html">Configuring Logging for the Micetro Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_management.html">Micetro User Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="webapp_external_auth.html">External Authentication</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Integrating with Microsoft Entra ID</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dependency-checklist">Dependency Checklist</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-setup">Installation/Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-central-server">Configuring Central Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-entra-id-azure-ad-authentication-in-the-micetro-web-interface">Configuring Entra ID (Azure AD) Authentication in the Micetro Web Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-authentication-and-access-management">User Authentication and Access Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manual-configuration-via-a-config-file">Manual Configuration via a Config File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mfa_okta.html">Integrating with Okta</a></li>
<li class="toctree-l3"><a class="reference internal" href="ad_user_auth.html">Active Directory User Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="ldap_user_auth.html">Lightweight Directory Access Protocol (LDAP) User Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="radius_user_auth.html">RADIUS User Authentication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="adding_dns.html">Adding DNS Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_dhcp.html">Adding DHCP Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_ip_ranges.html">IP Address Ranges and Devices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced_config.html">Advanced configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="updates.html">Update Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Micetro User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/webapp_user_guide.html">Using Micetro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/dns.html">DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/dhcp_scopes.html">DHCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/ipam.html">IPAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/folder_management.html">Folder management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/webapp_reporting.html">Reports Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/webapp_workflows.html">Workflow Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/view_change_history.html">Viewing Object Change History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/automation.html">Automation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Micetro Admin Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_license.html">License Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/access_control.html">Access Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/webapp_server_management.html">Service Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/failover_management.html">Failover Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/snmp_profiles.html">SNMP Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_event_hooks.html">Event Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/address_spaces.html">Address Space Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_custom_properties.html">Custom Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_system_settings.html">System Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_object_history.html">Viewing Global Object History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/webapp_sso.html">Configure Single Sign-On</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/webapp_appliance_management.html">Integrating and Managing Appliances</a></li>
<li class="toctree-l1"><a class="reference internal" href="updates.html">Update Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/reference.html">Micetro Reference Articles</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Management Console</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../management-console/management_console.html">Management Console (obsolete)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Micetro by Men&Mice - 11.0</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="configuration.html">Configuration</a></li>
          <li class="breadcrumb-item"><a href="webapp_external_auth.html">External Authentication</a></li>
      <li class="breadcrumb-item active">Integrating with Microsoft Entra ID</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/guides/implementation/mfa_azure.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="integrating-with-microsoft-entra-id">
<span id="mfa-azure"></span><h1>Integrating with Microsoft Entra ID<a class="headerlink" href="#integrating-with-microsoft-entra-id" title="Link to this heading"></a></h1>
<p>Integrating Micetro with Microsoft Entra ID (formerly Azure AD) can simplify the authentication process by providing multifactor authentication (MFA) and single sign-on (SSO) functionalities. After configuration, Micetro’s login page will include a button that, when clicked, directs users to Microsoft Entra ID’s authentication URL, where they can complete the authentication process using their Entra ID credentials and gain access to Micetro without the need to enter their login credentials repeatedly.</p>
<section id="dependency-checklist">
<h2>Dependency Checklist<a class="headerlink" href="#dependency-checklist" title="Link to this heading"></a></h2>
<ul>
<li><p>Configure and enable SSO and MFA in your identity provider.</p></li>
<li><p>Micetro web servers must be configured for HTTPS and have a valid certificate.</p></li>
<li><p>Central must have internet access to Entra ID’s endpoints:</p>
<blockquote>
<div><ul class="simple">
<li><p>login.microsoftonline.com</p></li>
<li><p>graph.microsoft.com</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Python with dependent libraries are installed on the Central server.</p>
<blockquote>
<div><ul class="simple">
<li><p>msal &gt;=1.17 - The Microsoft Authentication Library that enables Micetro to access the Cloud for AAD - <a class="reference external" href="https://pypi.org/project/msal/1.17.0/">https://pypi.org/project/msal/1.17.0/</a></p></li>
<li><p>requests - <a class="reference external" href="https://pypi.org/project/requests/">https://pypi.org/project/requests/</a></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If running Central in High Availability (HA) mode, it is recommended to disable the service on one of the partners. This will help ensure that the installation is successful on each server and prevent the servers from failing over during the installation process.</p>
<p>Installation and configuration must be performed on ALL Central servers in your environment.</p>
</div>
</section>
<section id="installation-setup">
<h2>Installation/Setup<a class="headerlink" href="#installation-setup" title="Link to this heading"></a></h2>
<dl>
<dt>Setting up the Application (Microsoft Entra ID)</dt><dd><p>To begin the configuration process, you’ll need to set up an application within Microsoft Entra ID. This step will provide you with the necessary properties required for configuration.</p>
<p>During this configuration, ensure you capture the credentials from Entra ID.</p>
</dd>
<dt>Permissions</dt><dd><p>To fetch the user’s profile information and group memberships, the application requires the following permissions:</p>
<a class="reference internal image-reference" href="../../_images/mfa-entra-permissions.png"><img alt="../../_images/mfa-entra-permissions.png" src="../../_images/mfa-entra-permissions.png" style="width: 100%;" /></a>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the application requests <code class="docutils literal notranslate"><span class="pre">User.Read</span></code> from the user, an administrator needs to grant <code class="docutils literal notranslate"><span class="pre">GroupMember.Read.All</span></code> permission. Without this permission, group membership syncing may not occur as expected.</p>
</div>
<dl>
<dt>Register the Application</dt><dd><ol class="arabic simple">
<li><p>Go to the Azure Portal and access Azure Active Directory (AAD).</p></li>
<li><p>On the left pane, select <span class="guilabel">App registrations</span> and then click <span class="guilabel">New Registration</span> within the newly opened “blade”.</p></li>
<li><p>Enter the name and select the appropriate authentication types. For the Redirect URI, select <strong>web</strong> and enter <a class="reference external" href="https://micetro.central.fqdn/mmws/auth_cb/microsoft">https://micetro.central.fqdn/mmws/auth_cb/microsoft</a></p></li>
<li><p>After registering the app, locate the client ID in the essentials panel.</p></li>
<li><p>Navigate to <strong>Certificates and Secrets</strong> to generate a new secret for the app’s use.</p></li>
</ol>
</dd>
<dt>Group authorization</dt><dd><p>The identity solution can be used in conjunction with group authorization models in Micetro.</p>
<p>Group membership synchronization operates by matching group names. Users are automatically added to groups within Micetro that correspond to groups listed by Entra ID, including both Active Directory (AD) and internal groups (excluding Built-in groups). Conversely, users are removed from groups within Micetro if their names do not match those listed by the Entra ID. If Entra ID does not provide any groups, the user’s group membership remains unchanged.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Entra ID offers options to filter and transform the provided groups during the application setup process.</p>
</div>
</dd>
<dt>Mapping groups from Microsoft Entra ID</dt><dd><p>As Entra ID only returns group ID with the token, the script makes an extra call to Microsoft Graph API to fetch the group names. As there is a limit of about 200 group IDs that can be returned within the JSON Web Token, filtering should be used to supply only the necessary groups.</p>
<p>For more information, see <a class="reference external" href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-fed-group-claims">Configure group claims for applications by using Microsoft Entra ID</a></p>
</dd>
</dl>
</section>
<section id="configuring-central-server">
<h2>Configuring Central Server<a class="headerlink" href="#configuring-central-server" title="Link to this heading"></a></h2>
<blockquote>
<div><ol class="arabic">
<li><p>Install Python and dependent libraries and packages on the Central server.</p>
<p>When installing Python, ensure the following:</p>
<ul class="simple">
<li><p>Python is available to “all user” (Windows).</p></li>
<li><p>Use Python version 3.7 or newer.</p></li>
<li><p>Python is installed in the “Default” environment.</p></li>
</ul>
</li>
<li><p><strong>Confirm that there is a directory called “extensions”</strong> in the Central data directory, and that it contains a Python script named <cite>mm_auth_cb.py</cite> and a signature file. This Python script handles the authentication callback from the external provider. The same script serves both providers. The directory and files are created during the installation of Micetro Central.</p></li>
</ol>
</div></blockquote>
</section>
<section id="configuring-entra-id-azure-ad-authentication-in-the-micetro-web-interface">
<h2>Configuring Entra ID (Azure AD) Authentication in the Micetro Web Interface<a class="headerlink" href="#configuring-entra-id-azure-ad-authentication-in-the-micetro-web-interface" title="Link to this heading"></a></h2>
<p>After completing the setup in Entra ID, the next step is to configure authentication in Micetro by entering the necessary information obtained during the application setup process. Once you have entered the information, save the configuration. Micetro will then test the integration with Entra ID to ensure it is working properly.</p>
<p><strong>To configure and test the authentication</strong>:</p>
<ol class="arabic simple">
<li><p>On the <span class="guilabel">Admin</span> page, select the <span class="guilabel">Configuration</span> tab.</p></li>
<li><p>Select <span class="guilabel">Authentication</span> under <span class="guilabel">System Settings</span> in the left pane.</p></li>
<li><p>Make sure the <span class="guilabel">Enable external login providers</span> checkbox is selected.</p></li>
<li><p>Click <span class="guilabel">Configure</span> and select <span class="guilabel">Azure AD</span> in the dropdown list.</p></li>
<li><p>Fill out the configuration form with the information collected during the Entra ID setup process.</p></li>
</ol>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/mfa-configure-azure.png"><img alt="../../_images/mfa-configure-azure.png" src="../../_images/mfa-configure-azure.png" style="width: 60%;" /></a>
<ul class="simple">
<li><p><strong>Client ID</strong>: A unique identifier for your application within Entra ID.</p></li>
<li><p><strong>Client credential</strong>: Enter the appropriate credential.</p></li>
<li><p><strong>Redirect URI</strong>: This should match the redirect UI configured in Entra ID.</p></li>
<li><p><strong>Scope</strong> (optional): Scopes define the level of access that the client application is requesting from the user during the authentication process.</p></li>
<li><p><strong>Use Azure US Government endpoints</strong> (optional): Select the Microsoft Graph endpoint you are required to use.</p></li>
</ul>
</div></blockquote>
<ol class="arabic" start="6">
<li><p>When you’re finished, click <span class="guilabel">Save and Test</span> Micetro will attempt to authenticate via the service and display a success message or a log explaining any failures encountered during the process.</p></li>
<li><p>Optional. If you want to provide only SSO/MFA login, you can disable the internal login method. This will remove the local login from the Micetro login page. However, you can still bypass this restriction at login. The internal login method can be found by clicking <strong>Log in with Micetro</strong> in the bottom left corner of the login page.</p>
<a class="reference internal image-reference" href="../../_images/sso-login-external.png"><img alt="../../_images/sso-login-external.png" src="../../_images/sso-login-external.png" style="width: 60%;" /></a>
<p>For more information about login options in Micetro, see <a class="reference internal" href="../admin-manual/admin_system_settings.html#admin-authentication"><span class="std std-ref">Authentication</span></a>.</p>
</li>
</ol>
</section>
<section id="user-authentication-and-access-management">
<h2>User Authentication and Access Management<a class="headerlink" href="#user-authentication-and-access-management" title="Link to this heading"></a></h2>
<p>Upon first login using Entra ID, a new user account is created in Micetro, categorized as “External”. Subsequent logins synchronize external changes to the user’s email, full name, and group memberships by matching the external ID.</p>
<p>It’s important to note that external user accounts authenticated via Entra ID and those integrated with AD-integrated SSO are treated as distinct entities within Micetro, each with its distinct user profile.</p>
<p>By default, all external users are automatically added to the “All users (built-in)” group. If group memberships are included in the properties returned by Entra ID, Micetro will add users to groups with matching names.</p>
<p>Micetro ensures synchronization of several key properties including email, full name, and group memberships. Any external changes to these properties are updated in Micetro upon subsequent logins.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Despite the automatic addition of new External accounts during initial login, administrators must manually grant access to the DNS/DHCP/IPAM roles.</p>
<p>Failure to grant privileges for these new external accounts will result in an error for the user.</p>
<a class="reference internal image-reference" href="../../_images/mfa-error.png"><img alt="../../_images/mfa-error.png" class="align-center" src="../../_images/mfa-error.png" style="width: 45%;" /></a>
</div>
</section>
<section id="manual-configuration-via-a-config-file">
<h2>Manual Configuration via a Config File<a class="headerlink" href="#manual-configuration-via-a-config-file" title="Link to this heading"></a></h2>
<p>Instead of using the Micetro Web Interface (see above), it is possible to configure external authentication manually by creating a JSON configuration file in Micetro Central’s data directory. At start up the Micetro Central program will search the data directory for a file named <cite>ext_auth_conf.json</cite>.</p>
<p>The structure of the JSON object inside the configuration file is unique for each customer depending on the identity solution that is being configured.</p>
<p>For more information on configuring external authentication manually, see the documentation for version 10.3. You can find detailed instructions in the section titled: <a class="reference internal" href="../management-console/external_auth.html#multi-factor-authentication"><span class="std std-ref">Single Sign-On (SSO) and Multi-Factor Authentication (MFA)</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="webapp_external_auth.html" class="btn btn-neutral float-left" title="External Authentication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mfa_okta.html" class="btn btn-neutral float-right" title="Integrating with Okta" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Men&amp;Mice.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>