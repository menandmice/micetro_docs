<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Micetro inventory plugin supports reading configuration from both a YAML configuration file and environment variables" name="description" />
<meta content="Micetro by Men&amp;Mice, Micetro inventory plugin" name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mm_inventory plugin &mdash; Micetro by Men&amp;Mice - 10.2  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="mm_ipinfo plugin" href="ansible_mm_ipinfo.html" />
    <link rel="prev" title="mm_freeip plugin" href="ansible_mm_freeip.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Micetro by Men&Mice - 10.2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Micetro by Men&amp;Mice</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security_announcements.html">Security announcements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Contacting Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opensource.html">Open-source licenses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Micetro Install Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../implementation/implementation.html">Implementation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/advanced_config.html">Advanced configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/updates.html">Update Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Micetro User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="ui.html">Micetro user interface(s)</a></li>
<li class="toctree-l1"><a class="reference internal" href="folder_management.html">Folder management</a></li>
<li class="toctree-l1"><a class="reference internal" href="dns.html">DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="dhcp.html">DHCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipam.html">IP address management</a></li>
<li class="toctree-l1"><a class="reference internal" href="devices.html">Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="active_directory.html">AD Sites and Subnets</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="automation.html">Automation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="rest_api.html">REST API for Micetro</a></li>
<li class="toctree-l2"><a class="reference internal" href="soap_api.html">SOAP API for Micetro</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="ansible.html">Ansible</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ansible_install.html">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="ansible_install.html#api-user">API user</a></li>
<li class="toctree-l3"><a class="reference internal" href="ansible_install.html#ansible-configuration-example">Ansible configuration example</a></li>
<li class="toctree-l3"><a class="reference internal" href="ansible_credentials.html">Credential matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="ansible_modules.html">Ansible modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="ansible_mm_freeip.html">mm_freeip plugin</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">mm_inventory plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#options">Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ansible_mm_ipinfo.html">mm_ipinfo plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="ansible_playbooks.html">Example playbooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="terraform.html">Terraform</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Micetro Admin Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_system_settings.html">System Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/access_control.html">Access control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_license.html">License Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/webapp_admin.html">Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/snmp_profiles.html">SNMP profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_custom_properties.html">Custom Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_schedule_scripts.html">Scheduled Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/admin_maintenance.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/appliance_management.html">Appliance management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual/caching_appliance.html">Caching DNS Servers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/reference.html">Micetro reference articles</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Micetro by Men&Mice - 10.2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="automation.html">Automation</a></li>
          <li class="breadcrumb-item"><a href="ansible.html">Ansible</a></li>
      <li class="breadcrumb-item active">mm_inventory plugin</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/guides/user-manual/ansible_mm_inventory.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mm-inventory-plugin">
<span id="ansible-mm-inventory"></span><h1>mm_inventory plugin<a class="headerlink" href="#mm-inventory-plugin" title="Link to this heading"></a></h1>
<p>This plugin generates the inventory from Micetro. It supports reading configuration from both a YAML configuration file and environment variables. If reading from the YAML file, the filename must end with <code class="docutils literal notranslate"><span class="pre">mm_inventory.(yml|yaml)</span></code>, the path in the command would be <code class="docutils literal notranslate"><span class="pre">/path/to/mm_inventory.(yml|yaml)</span></code>. If some arguments in the configuration file are missing, this plugin will try to fill in the missing arguments by reading from environment variables. If reading configurations from environment variables, the path in the command must be &#64;mm_inventory.</p>
<p>Valid configuration filenames are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mm_inventory</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mmsuite</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mandm</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">menandmice</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mandmsuite</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mm_suite</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mandm_suite</span></code></p></li>
</ul>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Link to this heading"></a></h2>
<p>There are two sets of configuration options, the options for the inventory plugin to function correctly and for Ansible to know how to use the plugin.</p>
<section id="plugin-configuration">
<h3>Plugin configuration<a class="headerlink" href="#plugin-configuration" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">mm_inventory</span></code> plugin is configured through a configuration file, named <code class="docutils literal notranslate"><span class="pre">mm_inventory.yml</span></code> and the options are:</p>
<dl class="simple">
<dt>plugin</dt><dd><p>Name of the plugin (mm_inventory)</p>
</dd>
<dt>host</dt><dd><p>Micetro to connect to (<a class="reference external" href="http://micetro.example.net">http://micetro.example.net</a>)</p>
</dd>
<dt>user</dt><dd><p>UserID to connect with (apiuser)</p>
</dd>
<dt>password</dt><dd><p>The password to connect with (apipasswd)</p>
</dd>
<dt>filters</dt><dd><p>Filter on custom properties, can be more than 1 and should be a list. If multiple filters are given, they act as an and function</p>
</dd>
<dt>ranges</dt><dd><p>What IP ranges to examine (172.16.17.0/24) Multiple ranges can be given, they act as an or function</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When both <em>ranges</em> and <em>filters</em> are supplied that will result in an and function.</p>
</div>
<p>Example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">filters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">home</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tonk</span>
<span class="nt">ranges</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.4.0/24</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.17.0/24</span>
</pre></div>
</div>
<p>Would result in an inventory for all host that have the <code class="docutils literal notranslate"><span class="pre">location:</span> <span class="pre">home</span></code> and <code class="docutils literal notranslate"><span class="pre">owner:</span> <span class="pre">tonk</span></code> custom properties set and are either a member of the 192.168.4.0/24 or 172.16.17.0/24 range.</p>
<p>An example of the <code class="docutils literal notranslate"><span class="pre">mm_inventory.yml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">plugin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mm_inventory</span>
<span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://micetro.example.net&quot;</span>
<span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apiuser</span>
<span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apipasswd</span>
<span class="nt">filters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">London</span>
<span class="nt">ranges</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.17.0/24</span>
</pre></div>
</div>
</section>
<section id="environment-variables">
<h3>Environment variables:<a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">mm_inventory</span></code> plugin can also be configured through environment variables</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">MM_HOST</span><span class="o">=</span>YOUR_MM_HOST_ADDRESS
<span class="nb">export</span><span class="w"> </span><span class="nv">MM_USER</span><span class="o">=</span>YOUR_MM_USER
<span class="nb">export</span><span class="w"> </span><span class="nv">MM_PASSWORD</span><span class="o">=</span>YOUR_MM_PASSWORD
<span class="nb">export</span><span class="w"> </span><span class="nv">MM_FILTERS</span><span class="o">=</span>YOUR_MM_FILTERS
<span class="nb">export</span><span class="w"> </span><span class="nv">MM_RANGES</span><span class="o">=</span>YOUR_MM_RANGES
</pre></div>
</div>
<p>When reading configuration from the environment, the inventory path must always be <code class="docutils literal notranslate"><span class="pre">&#64;mm_inventory</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-inventory<span class="w"> </span>-i<span class="w"> </span>@mm_inventory<span class="w"> </span>--list
</pre></div>
</div>
</section>
<section id="ansible-configuration">
<h3>Ansible configuration<a class="headerlink" href="#ansible-configuration" title="Link to this heading"></a></h3>
<p>Ansible needs to know about the <code class="docutils literal notranslate"><span class="pre">mm_inventory</span></code> plugin and also has some extra configuration options. First the <code class="docutils literal notranslate"><span class="pre">mm_inventory</span></code> plugin needs to be enabled, so Ansible can use it. This is done in the <code class="docutils literal notranslate"><span class="pre">[inventory]</span></code> section in the <code class="docutils literal notranslate"><span class="pre">ansible.cfg</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">inventory</span><span class="p">]</span>
<span class="n">enable_plugins</span>   <span class="o">=</span> <span class="n">mm_inventory</span><span class="p">,</span> <span class="n">host_list</span><span class="p">,</span> <span class="n">auto</span>
<span class="n">cache</span>            <span class="o">=</span> <span class="n">yes</span>
<span class="n">cache_plugin</span>     <span class="o">=</span> <span class="n">jsonfile</span>
<span class="n">cache_prefix</span>     <span class="o">=</span> <span class="n">mm_inv</span>
<span class="n">cache_timeout</span>    <span class="o">=</span> <span class="mi">3600</span>
<span class="n">cache_connection</span> <span class="o">=</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">mm_inventory_cache</span>
</pre></div>
</div>
<p>With the following meaning:</p>
<dl>
<dt>cache:</dt><dd><p>Switch caching on and off</p>
</dd>
<dt>cache_plugin:</dt><dd><p>Which caching plugin to use</p>
<blockquote>
<div><ul class="simple">
<li><p>jsonfile</p></li>
<li><p>yaml</p></li>
<li><p>pickle</p></li>
<li><p>…</p></li>
</ul>
</div></blockquote>
</dd>
<dt>cache_prefix:</dt><dd><p>User defined prefix to use when creating the cache files</p>
</dd>
<dt>cache_connection:</dt><dd><p>Path in which the cache plugin will save the cache files</p>
</dd>
<dt>cache_timeout:</dt><dd><p>Timeout for the cache in seconds</p>
</dd>
</dl>
<p>Now the inventory plugin can be used with Ansible, like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ansible-inventory<span class="w"> </span>-i<span class="w"> </span>/path/to/mm_inventory.yml<span class="w"> </span>--list
</pre></div>
</div>
<p>Or set the <code class="docutils literal notranslate"><span class="pre">mm_inventory.yml</span></code> as the Ansible inventory in the <code class="docutils literal notranslate"><span class="pre">ansible.cfg</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inventory</span> <span class="o">=</span> <span class="n">mm_inventory</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ansible_mm_freeip.html" class="btn btn-neutral float-left" title="mm_freeip plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ansible_mm_ipinfo.html" class="btn btn-neutral float-right" title="mm_ipinfo plugin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Men&amp;Mice.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>