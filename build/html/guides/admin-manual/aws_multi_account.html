<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="How to connect Micetro by Men&amp;Mice to multiple AWS accounts using single credentials" name="description" />
<meta content="Micetro credentials, AWS management console, Micetro by Men&amp;Mice," name="keywords" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuring an AWS multi-account setup &mdash; Micetro by Men&amp;Mice - 10.2  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Micetro by Men&Mice - 10.2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Micetro by Men&amp;Mice</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security_announcements.html">Security announcements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Contacting Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../opensource.html">Open-source licenses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Micetro Install Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../implementation/implementation.html">Implementation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/advanced_config.html">Advanced configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/updates.html">Update Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Micetro User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/introduction.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/ui.html">Micetro user interface(s)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/folder_management.html">Folder management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/dns.html">DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/dhcp.html">DHCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/ipam.html">IP address management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/devices.html">Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/active_directory.html">AD Sites and Subnets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual/automation.html">Automation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Micetro Admin Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="admin_system_settings.html">System Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="access_control.html">Access control</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_license.html">License Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="webapp_admin.html">Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="snmp_profiles.html">SNMP profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_custom_properties.html">Custom Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_schedule_scripts.html">Scheduled Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_maintenance.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="appliance_management.html">Appliance management</a></li>
<li class="toctree-l1"><a class="reference internal" href="caching_appliance.html">Caching DNS Servers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/reference.html">Micetro reference articles</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Micetro by Men&Mice - 10.2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Configuring an AWS multi-account setup</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/guides/admin-manual/aws_multi_account.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuring-an-aws-multi-account-setup">
<span id="aws-multi-account"></span><h1>Configuring an AWS multi-account setup<a class="headerlink" href="#configuring-an-aws-multi-account-setup" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>Micetro can be connected to multiple AWS accounts using single credentials. This is done by configuring a cloud account to be able to assume roles on other accounts. The credentials added to Micetro when adding multiple AWS cloud accounts, should belong to a user that is a member of a group. The group should be configured to allow members to assume AWS roles on other accounts with access to cloud networks(via EC2) or DNS Services(via Route53). Step-by-step instructions on how to configure this setup can be found below.</p>
</section>
<section id="set-up-and-configuration">
<h2>Set up and configuration<a class="headerlink" href="#set-up-and-configuration" title="Link to this heading"></a></h2>
<p>The following steps should be taken when configuring an AWS account to assume roles on other accounts for Micetro.</p>
<section id="i-creating-a-group-containing-the-user-that-should-have-access-to-the-roles-on-the-other-accounts">
<h3>I. Creating a group containing the user that should have access to the roles on the other accounts<a class="headerlink" href="#i-creating-a-group-containing-the-user-that-should-have-access-to-the-roles-on-the-other-accounts" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Find a pre-existing user that you want to use, or create a new user.</p></li>
</ol>
<p>This can be done through the AWS Management Console or using the AWS CLI command <code class="docutils literal notranslate"><span class="pre">[iam|create-user]</span></code></p>
<p>Open the <span class="guilabel">IAM service</span> in the management console.</p>
<ol class="arabic simple" start="2">
<li><p>Select <span class="guilabel">Users</span> from the left-hand menu or under IAM resources.</p></li>
<li><p>Either select an existing user to use, or create a new user by clicking <span class="guilabel">Add user</span> and following the steps described in the wizard. If a new user is created, make sure to allow programmatic access so that an access key ID and secret access key pair can be used to add the account to Micetro. The user must also have the IAMReadOnlyAccess policy attached. If you want to manage Route53 and VPCs on the account where the user is located, the AmazonRoute53FullAccess and AmazonEC2Full access policies should also be attached.</p></li>
<li><p>Create a group</p></li>
</ol>
<p>This can be done through the AWS Management Console or by using the AWS CLI command <code class="docutils literal notranslate"><span class="pre">[iam|create-group]</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure this is done under the account where the user is located.</p>
</div>
<ol class="arabic simple" start="5">
<li><p>Under the <em>IAM</em> service, select <span class="guilabel">Groups</span>.</p></li>
<li><p>Select the <span class="guilabel">Create New Group</span> button.</p></li>
<li><p>You will be offered policies to attach to your group. Just press <span class="guilabel">Next Step</span>.</p></li>
<li><p>A review window will be displayed. Press <span class="guilabel">Create Group</span> to finish creating the group.</p></li>
<li><p>Add the user to the group created in the previous step. This can be done through the AWS Management Console or by using the AWS CLI command <code class="docutils literal notranslate"><span class="pre">[iam|add-user-to-group]</span></code></p></li>
<li><p>From the <strong>Groups</strong> menu under the IAM service, click on the newly created group.</p></li>
<li><p>Under the users tab, click <span class="guilabel">Add Users to Group</span>.</p></li>
<li><p>Select the checkbox next to the user that should be added to the group. This should either be the user created earlier, or a pre-existing user you’ve decided to use. Then click on the <span class="guilabel">Add Users</span> button.</p></li>
</ol>
</section>
<section id="ii-for-each-account-that-the-user-should-have-access-to-create-and-configure-a-role-on-the-account">
<h3>II. For each account that the user should have access to, create and configure a role on the account<a class="headerlink" href="#ii-for-each-account-that-the-user-should-have-access-to-create-and-configure-a-role-on-the-account" title="Link to this heading"></a></h3>
<p>The following steps should be performed for each account that the user should have access to.</p>
<p>Now a role has to be created on the accounts that the user should have access to, the role has to be assumable by the user.</p>
<p>This can be done through the AWS Management Console or by using the AWS CLI command <code class="docutils literal notranslate"><span class="pre">[iam|create-role]</span></code></p>
<ol class="arabic simple">
<li><p>Log in to the account that the user should have access to using the AWS Management Console.</p></li>
<li><p>Open the <strong>IAM</strong> service in the management console.</p></li>
<li><p>Select <span class="guilabel">Roles</span> from the menu on the left or under the IAM resource.</p></li>
<li><p>Press the <span class="guilabel">Create role</span> button.</p></li>
<li><p>Select <span class="guilabel">Another AWS account</span> as the type of trusted entity. In the Account ID window, put the account ID of the account that contains the user that should be able to access this account. Then click <span class="guilabel">Next: Permissions</span>.</p></li>
<li><p>Now attach necessary policies for Micetro to the role. You can attach the policies by searching for them by name in the search window and then checking the checkbox next to their name. After all necessary policies have been attached, click on the <span class="guilabel">Next: Tags</span> button. Micetro needs the following AWS policies to be attached.</p></li>
</ol>
<ul class="simple">
<li><p><em>AmazonRoute53FullAccess</em> to manage hosted DNS zones.</p></li>
<li><p><em>AmazonEC2FullAccess</em> to manage Cloud Networks and ranges.</p></li>
<li><p><em>IAMReadOnlyAccess</em> so that Micetro can access the account alias. This does not need to be attached if you do not want AWS account aliases to be displayed in Micetro.</p></li>
</ul>
<p>This can also be done using the AWS CLI command <code class="docutils literal notranslate"><span class="pre">[iam|attach-role-policy]</span></code></p>
<ol class="arabic simple" start="7">
<li><p>Now you can add tags to the role. Micetro does not require any tags but they can be added optionally to help organize your account. After you finish adding tags, click on the <span class="guilabel">Next: Review</span> button.</p></li>
<li><p>Now select a name for the role that is being created and review the role before confirming the creation. After naming the role and ideally writing a short description, press the <span class="guilabel">Create role</span> button.</p></li>
</ol>
</section>
<section id="iii-add-inline-group-policies-to-the-group-that-contains-the-user-for-each-of-the-roles-created">
<h3>III. Add inline group policies to the group that contains the user for each of the roles created<a class="headerlink" href="#iii-add-inline-group-policies-to-the-group-that-contains-the-user-for-each-of-the-roles-created" title="Link to this heading"></a></h3>
<p>The following steps should be performed for each account that the user should have access to.</p>
<p>On the account where the user that should have access to the roles is located, locate the group created in the first step of this tutorial. The group should contain the user that should have access to the roles. For each account that the user should have access to, create a group policy in the group allowing him to assume the role that was created on the account.</p>
<p>This can be done through the AWS Management Console or by using the AWS CLI command <code class="docutils literal notranslate"><span class="pre">[iam|put-group</span> <span class="pre">policy]</span></code></p>
<ol class="arabic simple">
<li><p>Log in to the account where the group is located using the AWS Management Console.</p></li>
<li><p>Open the <strong>IAM</strong> service in the management console.</p></li>
<li><p>Under the IAM service, select <span class="guilabel">Groups</span>.</p></li>
<li><p>Locate the group that was previously created and click on it to open up further options for the group.</p></li>
<li><p>Under the permissions tab, locate inline policies and create a new one. It is very important that the policy is created as an inline policy, a managed policy will not work.</p></li>
<li><p>Check the <span class="guilabel">Custom Policy</span> option and click on the <span class="guilabel">Select</span> button.</p></li>
<li><p>Type a name for your policy into the <strong>Policy Name</strong> field. Paste the following policy into the Policy Document field. Replace <code class="docutils literal notranslate"><span class="pre">123456789012</span></code> with the ID of the account where the role is located and replace <code class="docutils literal notranslate"><span class="pre">RoleName</span></code> with the name of the role that should be assumed on the account. Then click on the <span class="guilabel">Apply Policy</span> button.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
  <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
          <span class="s2">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:iam::123456789012:role/RoleName&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="after-configuring-the-accounts">
<h2>After Configuring the accounts<a class="headerlink" href="#after-configuring-the-accounts" title="Link to this heading"></a></h2>
<p>After adding the policies to the group for all of the roles, the accounts can be added to Micetro using the API credentials of the user that is in the group. Further information on how to add AWS accounts to Micetro can be found here. You might need to wait a couple of minutes for the AWS backend to propagate the changes everywhere.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Men&amp;Mice.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>